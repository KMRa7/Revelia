<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã‚·ãƒ¼ãƒˆ</title>

  <style>
    :root{
      --bg:#f2f2f2;
      --line:#e6e6e6;
      --text:#222;
      --muted:#777;
      --card:#fff;
      --input:#fff;
      --radius:6px;
      --dark:#222;
      --danger:#d60000;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
    }
    .titlebar{
      background:#efefef;
      border-bottom:1px solid var(--line);
      padding:12px 14px;
      text-align:center;
      font-weight:800;
      letter-spacing:.02em;
      position:sticky;
      top:0;
      z-index:10;
    }
    .sheet{
      max-width:720px;
      margin:0 auto;
      background:var(--card);
      border-top:1px solid var(--line);
      border-bottom:1px solid var(--line);
    }
    .row{
      display:flex;
      gap:12px;
      padding:14px;
      border-top:1px solid var(--line);
      align-items:flex-start;
    }
    .row:first-child{ border-top:0; }
    .label{
      width:180px;
      min-width:180px;
      font-weight:800;
      padding-top:10px;
      line-height:1.2;
    }
    .label .req{ margin-left:4px; font-weight:900; }
    .control{ flex:1; }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
      line-height:1.4;
    }
    input, select, textarea{
      width:100%;
      border:1px solid #d6d6d6;
      border-radius:var(--radius);
      padding:0 12px;
      background:var(--input);
      font-size:16px;
      outline:none;
    }
    input, select{ height:46px; }
    textarea{
      padding:10px 12px;
      min-height:110px;
      resize:vertical;
      font-size:16px;
    }
    input:focus, select:focus, textarea:focus{
      border-color:#9bbcff;
      box-shadow:0 0 0 3px rgba(11,99,255,.12);
    }

    .subControl{ margin-top:10px; }

    .chkGrid{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:6px;
    }
    .chk{
      width:100%;
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 12px;
      border:1px solid #d6d6d6;
      border-radius:12px;
      background:#fff;
      font-weight:800;
      user-select:none;
    }
    .chk input{
      width:20px;
      height:20px;
      accent-color:#111;
    }

    /* actions */
    .actionsRow{
      padding:18px 14px 22px;
      border-top:1px solid var(--line);
      background:#fff;
      position:sticky;
      bottom:0;
      z-index:5;
      padding-bottom:calc(22px + env(safe-area-inset-bottom));
    }
    .twoBtns{ display:flex; gap:12px; }
    .pillConfirm{
      flex:1;
      height:52px;
      border-radius:999px;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      border:2px solid #111;
      background:#fff;
      color:#111;
    }
    .pillConfirm:disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    /* confirm view */
    .confirm{ display:none; padding:14px; }
    .confirm h2{ margin:8px 0 12px; font-size:18px; }
    .summary{
      border:1px solid var(--line);
      border-radius:12px;
      overflow:hidden;
      background:#fff;
    }
    .sumRow{
      display:flex;
      gap:12px;
      padding:12px 14px;
      border-top:1px solid var(--line);
    }
    .sumRow:first-child{ border-top:0; }
    .sumKey{
      width:200px;
      min-width:200px;
      color:#111;
      font-weight:900;
    }
    .sumVal{ flex:1; color:#222; word-break:break-word; }
    .confirmActions{ display:flex; gap:12px; margin-top:14px; }
    .ghost{
      flex:1;
      height:52px;
      border-radius:999px;
      border:2px solid #666;
      background:#fff;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      color:#111;
    }
    .send{
      flex:1;
      height:52px;
      border-radius:999px;
      border:0;
      background:var(--dark);
      color:#fff;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
    }

    @media (max-width:520px){
      .label{ width:140px; min-width:140px; }
      .sumKey{ width:140px; min-width:140px; }
    }

    /* ã‚¹ãƒãƒ›æœ€é©åŒ– */
    html{ -webkit-text-size-adjust:100%; }
    .sheet{ max-width:640px; width:100%; }
    .row{
      display:grid;
      grid-template-columns:140px 1fr;
      align-items:center;
      gap:10px;
    }
    .label{ width:auto; min-width:0; padding-top:0; font-size:15px; }
    @media (max-width:380px){
      .row{ grid-template-columns:1fr; align-items:start; }
      .label{ padding-top:0; }
    }

    /* ---- start view (ãŠã—ã‚ƒã‚Œç‰ˆ) ---- */
    .startHero{
      padding:18px 14px 6px;
      background:linear-gradient(180deg, #ffffff, #fbfbfb);
      border-bottom:1px solid var(--line);
    }
    .startBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid #e8e8e8;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      color:#111;
      background:#fff;
      box-shadow:0 6px 18px rgba(0,0,0,.04);
    }
    .startTitle{
      margin:10px 0 6px;
      font-size:20px;
      letter-spacing:.02em;
    }
    .startLead{
      margin:0 0 8px;
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
    }

    .startCards{
      padding:12px 14px 10px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .startCard{
      width:100%;
      border:1px solid #e5e5e5;
      border-radius:16px;
      background:#fff;
      padding:14px 14px;
      display:flex;
      align-items:center;
      gap:12px;
      cursor:pointer;
      text-align:left;
      box-shadow:0 10px 26px rgba(0,0,0,.06);
      transition:transform .08s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .startCard:hover{
      border-color:#dcdcdc;
      box-shadow:0 12px 32px rgba(0,0,0,.08);
    }
    .startCard:active{
      transform:translateY(1px);
      box-shadow:0 8px 20px rgba(0,0,0,.06);
    }
    .startIcon{
      width:44px;
      height:44px;
      border-radius:14px;
      display:grid;
      place-items:center;
      border:1px solid #eee;
      background:#fafafa;
      font-size:20px;
      flex:0 0 auto;
    }
    .startText{ flex:1; min-width:0; }
    .startMain{
      font-size:18px;
      font-weight:900;
      color:#111;
      line-height:1.2;
    }
    .startSub{
      margin-top:4px;
      font-size:12px;
      font-weight:700;
      color:var(--muted);
      line-height:1.4;
    }
    .startArrow{
      font-size:26px;
      font-weight:900;
      color:#bbb;
      margin-left:4px;
      flex:0 0 auto;
    }
    .startNote{
      padding:0 14px 18px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:8px;
      align-items:flex-start;
    }
    .startNoteDot{ font-size:10px; margin-top:2px; }

    /* ---- view transition (ãµã‚ã£ã¨åˆ‡æ›¿) ---- */
    .viewFade{
      animation:viewFade .18s ease-out;
    }
    @keyframes viewFade{
      from{ opacity:0; transform:translateY(6px); }
      to{ opacity:1; transform:translateY(0); }
    }

    html, body{
      width:100%;
      max-width:100%;
      overflow-x:hidden;   /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æŠ‘æ­¢ */
    }
  </style>
</head>

<body>
  <div class="titlebar">ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã‚·ãƒ¼ãƒˆ</div>

  <!-- æœ€åˆã®äºŒæŠãƒšãƒ¼ã‚¸ -->
  <main class="sheet" id="startView" style="display:none;">
    <div class="startHero">
      <div class="startBadge">STEP 1</div>
      <h1 class="startTitle">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠ</h1>
      <p class="startLead">ãƒœãƒ‡ã‚£ï¼ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«ã‚’é¸ã¶ã¨ã€ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã‚·ãƒ¼ãƒˆãŒå§‹ã¾ã‚Šã¾ã™ã€‚</p>
    </div>

    <div class="startCards">
      <button type="button" class="startCard" id="startBody" aria-label="ãƒœãƒ‡ã‚£ã‚’é¸æŠ">
        <div class="startIcon" aria-hidden="true">ğŸ«§</div>
        <div class="startText">
          <div class="startMain">â‘  ãƒœãƒ‡ã‚£</div>
          <div class="startSub">è‚©ã“ã‚Šãƒ»ã‚€ãã¿ãƒ»ç–²ã‚Œãƒ»ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãªã©</div>
        </div>
        <div class="startArrow" aria-hidden="true">â€º</div>
      </button>

      <button type="button" class="startCard" id="startFacial" aria-label="ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«ã‚’é¸æŠ">
        <div class="startIcon" aria-hidden="true">âœ¨</div>
        <div class="startText">
          <div class="startMain">â‘¡ ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«</div>
          <div class="startSub">ä¿æ¹¿ãƒ»æ¯›ç©´ãƒ»ãƒªãƒ•ãƒˆãªã©</div>
        </div>
        <div class="startArrow" aria-hidden="true">â€º</div>
      </button>
    </div>

    <div class="startNote">
      <span class="startNoteDot">â—</span>
      é¸æŠå¾Œã‚‚ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹ã€ã‹ã‚‰åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã™ã€‚
    </div>
  </main>

  <!-- å…¥åŠ›ç”»é¢ -->
  <main class="sheet" id="inputView" style="display:none;">
    <form id="reserveForm" novalidate>

      <!-- äºˆç´„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ç”¨ã«æ®‹ã™ï¼šç”»é¢ã«ã¯å‡ºã•ãªã„ï¼‰ -->
      <div class="row" style="display:none;">
        <div class="label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼<span class="req">*</span></div>
        <div class="control">
          <p class="hint">â‘ ãƒœãƒ‡ã‚£ï¼â‘¡ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ« ã‹ã‚‰ãŠé¸ã³ãã ã•ã„ã€‚</p>
          <select id="menu" required>
            <option value="">â€”</option>
            <option value="ãƒœãƒ‡ã‚£">â‘  ãƒœãƒ‡ã‚£</option>
            <option value="ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«">â‘¡ ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«</option>
          </select>
        </div>
      </div>

      <!-- ãƒœãƒ‡ã‚£ï¼šç›®çš„ -->
      <div class="row" id="bodyPurposeRow" style="display:none;">
        <div class="label">ç›®çš„<span class="req">*</span></div>
        <div class="control">
          <p class="hint">ãƒœãƒ‡ã‚£ã‚’é¸æŠã—ãŸæ–¹ï¼šç›®çš„ã‚’ãŠé¸ã³ãã ã•ã„ã€‚</p>
          <select id="bodyPurpose">
            <option value="">â€”</option>
            <option value="ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³">â‘  ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³</option>
            <option value="ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ">â‘¡ ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ</option>
            <option value="ã©ã¡ã‚‰ã‚‚">â‘¢ ã©ã¡ã‚‰ã‚‚</option>
          </select>
        </div>
      </div>

      <!-- ãƒœãƒ‡ã‚£ï¼šæ°—ã«ãªã‚‹ã¨ã“ã‚ -->
      <div class="row" id="bodyConcernRow" style="display:none;">
        <div class="label">æ°—ã«ãªã‚‹ã¨ã“ã‚<span class="req">*</span></div>
        <div class="control">
          <p class="hint">è¤‡æ•°é¸æŠã§ãã¾ã™ã€‚</p>
          <div class="chkGrid">
            <label class="chk"><input type="checkbox" id="c_shoulder" value="è‚©ã“ã‚Š">è‚©ã“ã‚Š</label>
            <label class="chk"><input type="checkbox" id="c_headache" value="é ­ç—›">é ­ç—›</label>
            <label class="chk"><input type="checkbox" id="c_neck" value="é¦–">é¦–</label>
            <label class="chk"><input type="checkbox" id="c_lowback" value="è…°ç—›">è…°ç—›</label>
            <label class="chk"><input type="checkbox" id="c_swelling" value="ã‚€ãã¿">ã‚€ãã¿</label>
            <label class="chk"><input type="checkbox" id="c_belly" value="ãŠè…¹">ãŠè…¹</label>
            <label class="chk"><input type="checkbox" id="c_upperarm" value="äºŒã®è…•">äºŒã®è…•</label>
            <label class="chk"><input type="checkbox" id="c_back" value="èƒŒä¸­">èƒŒä¸­</label>
            <label class="chk"><input type="checkbox" id="c_hip" value="ãŠã—ã‚Š">ãŠã—ã‚Š</label>
            <label class="chk"><input type="checkbox" id="c_thigh" value="å¤ªã‚‚ã‚‚">å¤ªã‚‚ã‚‚</label>
            <label class="chk"><input type="checkbox" id="c_calf" value="ãµãã‚‰ã¯ã">ãµãã‚‰ã¯ã</label>
          </div>
        </div>
      </div>

      <!-- ãƒœãƒ‡ã‚£ï¼šãƒ€ã‚¤ã‚¨ãƒƒãƒˆè©³ç´°ï¼ˆç›®çš„ãŒãƒ€ã‚¤ã‚¨ãƒƒãƒˆ or ã©ã¡ã‚‰ã‚‚ï¼‰ -->
      <div class="row" id="dietDeadlineRow" style="display:none;">
        <div class="label">ã„ã¤ã¾ã§ã«<span class="req">*</span></div>
        <div class="control">
          <p class="hint">ä¾‹ï¼š3æœˆæœ«ã¾ã§ï¼2ãƒ¶æœˆä»¥å†… ãªã©</p>
          <input id="dietDeadline" type="text" placeholder="ä¾‹ï¼š3æœˆæœ«ã¾ã§" />
        </div>
      </div>

      <div class="row" id="dietFocusRow" style="display:none;">
        <div class="label">é‡è¦–<span class="req">*</span></div>
        <div class="control">
          <p class="hint">ä½“é‡ or ãƒœãƒ‡ã‚£ãƒ©ã‚¤ãƒ³ã€ã©ã¡ã‚‰é‡è¦–ã§ã™ã‹ï¼Ÿ</p>
          <select id="dietFocus">
            <option value="">â€”</option>
            <option value="ä½“é‡é‡è¦–">ä½“é‡é‡è¦–</option>
            <option value="ãƒœãƒ‡ã‚£ãƒ©ã‚¤ãƒ³é‡è¦–">ãƒœãƒ‡ã‚£ãƒ©ã‚¤ãƒ³é‡è¦–</option>
          </select>
        </div>
      </div>

      <div class="row" id="dietGoalRow" style="display:none;">
        <div class="label">ç›®æ¨™<span class="req">*</span></div>
        <div class="control">
          <p class="hint">ä¾‹ï¼šâˆ’3kgï¼ã‚¦ã‚¨ã‚¹ãƒˆâˆ’5cm ãªã©ï¼ˆè‡ªç”±è¨˜å…¥ï¼‰</p>
          <input id="dietGoal" type="text" placeholder="ä¾‹ï¼šâˆ’3kg" />
        </div>
      </div>

      <!-- ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«ï¼ˆé¸æŠè‚¢å¤‰æ›´ï¼‰ -->
      <div class="row" id="facialTypeRow" style="display:none;">
        <div class="label">ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«å†…å®¹<span class="req">*</span></div>
        <div class="control">
          <p class="hint">å†…å®¹ã‚’ãŠé¸ã³ãã ã•ã„ã€‚</p>
          <select id="facialType">
            <option value="">â€”</option>
            <option value="çµæœé‡è¦–">çµæœé‡è¦–</option>
            <option value="ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³">ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³</option>
          </select>
        </div>
      </div>

      <!-- å…±é€šï¼šç”Ÿæ´»é¢ï¼ˆç¡çœ ï¼‰ -->
      <div class="row">
        <div class="label">ç¡çœ </div>
        <div class="control">
          <p class="hint">å°±å¯ï¼èµ·åºŠæ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
          <div class="subControl">
            <label class="hint" for="sleepBed">å°±å¯</label>
            <input id="sleepBed" type="time" />
          </div>
          <div class="subControl">
            <label class="hint" for="sleepWake">èµ·åºŠ</label>
            <input id="sleepWake" type="time" />
          </div>
        </div>
      </div>

      <!-- å…±é€šï¼šç”Ÿç†ç—› -->
      <div class="row">
        <div class="label">ç”Ÿç†ç—›</div>
        <div class="control">
          <select id="periodPain">
            <option value="">â€”</option>
            <option value="ãªã—">ãªã—</option>
            <option value="ã‚ã‚Š">ã‚ã‚Š</option>
          </select>

          <div class="subControl" id="periodPainLevelWrap" style="display:none;">
            <p class="hint">ã€Œã‚ã‚Šã€ã®å ´åˆã€ç¨‹åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
            <select id="periodPainLevel">
              <option value="">â€”</option>
              <option value="è»½åº¦">è»½åº¦</option>
              <option value="ä¸­åº¦">ä¸­åº¦</option>
              <option value="é‡åº¦">é‡åº¦</option>
            </select>
          </div>
        </div>
      </div>

      <!-- å…±é€šï¼šç”Ÿç†å‘¨æœŸ -->
      <div class="row">
        <div class="label">ç”Ÿç†å‘¨æœŸ</div>
        <div class="control">
          <select id="periodCycle">
            <option value="">â€”</option>
            <option value="äºˆå®šé€šã‚Š">äºˆå®šé€šã‚Š</option>
            <option value="ä¸é †">ä¸é †</option>
          </select>
        </div>
      </div>

      <!-- å…±é€šï¼šé£Ÿäº‹é¢ -->
      <div class="row">
        <div class="label">é£Ÿäº‹ãƒªã‚ºãƒ </div>
        <div class="control">
          <select id="mealRhythm">
            <option value="">â€”</option>
            <option value="è¦å‰‡æ­£ã—ã„">è¦å‰‡æ­£ã—ã„</option>
            <option value="ä¸è¦å‰‡">ä¸è¦å‰‡</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="label">é£Ÿäº‹</div>
        <div class="control">
          <p class="hint">æœé£Ÿï¼æ˜¼é£Ÿï¼å¤•é£Ÿãã‚Œãã‚Œé¸æŠã—ã¦ãã ã•ã„ã€‚</p>

          <div class="subControl">
            <label class="hint" for="breakfast">æœé£Ÿ</label>
            <select id="breakfast">
              <option value="">â€”</option>
              <option value="æ‘‚ã‚Œã¦ã„ã‚‹">æ‘‚ã‚Œã¦ã„ã‚‹</option>
              <option value="æ‘‚ã‚Œã¦ã„ãªã„">æ‘‚ã‚Œã¦ã„ãªã„</option>
            </select>
          </div>

          <div class="subControl">
            <label class="hint" for="lunch">æ˜¼é£Ÿ</label>
            <select id="lunch">
              <option value="">â€”</option>
              <option value="æ‘‚ã‚Œã¦ã„ã‚‹">æ‘‚ã‚Œã¦ã„ã‚‹</option>
              <option value="æ‘‚ã‚Œã¦ã„ãªã„">æ‘‚ã‚Œã¦ã„ãªã„</option>
            </select>
          </div>

          <div class="subControl">
            <label class="hint" for="dinner">å¤•é£Ÿ</label>
            <select id="dinner">
              <option value="">â€”</option>
              <option value="æ‘‚ã‚Œã¦ã„ã‚‹">æ‘‚ã‚Œã¦ã„ã‚‹</option>
              <option value="æ‘‚ã‚Œã¦ã„ãªã„">æ‘‚ã‚Œã¦ã„ãªã„</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="label">é–“é£Ÿ</div>
        <div class="control">
          <select id="snack">
            <option value="">â€”</option>
            <option value="ã‚ã‚Š">ã‚ã‚Š</option>
            <option value="ãªã—">ãªã—</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="label">å¥½ããªé£Ÿã¹ç‰©</div>
        <div class="control">
          <input id="favoriteFood" type="text" placeholder="ä¾‹ï¼šç”˜ã„ã‚‚ã®ã€å’Œé£Ÿã€è¾›ã„ã‚‚ã® ãªã©" />
        </div>
      </div>

      <div class="row">
        <div class="label">å¤–é£Ÿé »åº¦</div>
        <div class="control">
          <select id="eatingOut">
            <option value="">â€”</option>
            <option value="é€±1">é€±1</option>
            <option value="æœˆ2">æœˆ2</option>
            <option value="æœˆ1">æœˆ1</option>
            <option value="ãŸã¾ã«">ãŸã¾ã«</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="label">ãŠé…’</div>
        <div class="control">
          <p class="hint">é »åº¦ã¨ã€1æ—¥ã©ã‚Œãã‚‰ã„ã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
          <select id="alcoholFreq">
            <option value="">â€”</option>
            <option value="æ¯æ—¥">æ¯æ—¥</option>
            <option value="é€±1">é€±1</option>
            <option value="æœˆ2">æœˆ2</option>
            <option value="ãŸã¾ã«">ãŸã¾ã«</option>
          </select>
          <div class="subControl">
            <input id="alcoholAmount" type="text" placeholder="ä¾‹ï¼šãƒ“ãƒ¼ãƒ«1æœ¬ï¼ãƒ¯ã‚¤ãƒ³2æ¯ ãªã©" />
          </div>
        </div>
      </div>

      <!-- â˜…è¿½åŠ ï¼šã‚¿ãƒã‚³ -->
      <div class="row">
        <div class="label">ã‚¿ãƒã‚³</div>
        <div class="control">
          <p class="hint">ã‚¿ãƒã‚³ã¯å¸ã‚ã‚Œã¾ã™ã‹ï¼Ÿ</p>
          <select id="smoking">
            <option value="">â€”</option>
            <option value="å¸ã†">å¸ã†</option>
            <option value="å¸ã‚ãªã„">å¸ã‚ãªã„</option>
          </select>

          <div class="subControl" id="smokingAmountWrap" style="display:none;">
            <p class="hint">ã€Œå¸ã†ã€ã®å ´åˆã€æœ¬æ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
            <select id="smokingAmount">
              <option value="">â€”</option>
              <option value="1æ—¥15~20æœ¬">1æ—¥15~20æœ¬</option>
              <option value="1æ—¥10~15æœ¬">1æ—¥10~15æœ¬</option>
              <option value="1æ—¥1~10æœ¬">1æ—¥1~10æœ¬</option>
              <option value="ãŸã¾ã«å¸ã†">ãŸã¾ã«å¸ã†</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="label">ã‚«ãƒ•ã‚§ã‚¤ãƒ³</div>
        <div class="control">
          <p class="hint">ã€Œãªã—ã€ã¾ãŸã¯1æ—¥ã®æ¯æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
          <select id="caffeineType">
            <option value="">â€”</option>
            <option value="ãªã—">ãªã—</option>
            <option value="æ¯æ•°ã‚’å…¥åŠ›">æ¯æ•°ã‚’å…¥åŠ›</option>
          </select>

          <div class="subControl" id="caffeineCupsWrap" style="display:none;">
            <input id="caffeineCups" type="number" inputmode="numeric" min="0" step="1" placeholder="ä¾‹ï¼š2" />
          </div>
        </div>
      </div>

      <div class="actionsRow">
        <div class="twoBtns">
          <button class="pillConfirm" type="button" id="toStart">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
          <button class="pillConfirm" type="button" id="toConfirm">ç¢ºèª</button>
        </div>
      </div>
    </form>
  </main>

  <!-- ç¢ºèªç”»é¢ -->
  <main class="sheet confirm" id="confirmView" aria-live="polite">
    <div style="padding:14px;">
      <h2>å…¥åŠ›å†…å®¹ã®ç¢ºèª</h2>
      <div class="summary" id="summary"></div>

      <div class="confirmActions">
        <button class="ghost" type="button" id="backBtn">æˆ»ã‚‹</button>
        <button class="send" type="button" id="sendBtn">é€ä¿¡</button>
      </div>
    </div>
  </main>

  <!-- LIFF -->
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

  <script>
    // â˜…å¿…è¦ã«å¿œã˜ã¦å·®ã—æ›¿ãˆã¦ãã ã•ã„
    const LIFF_ID = "2008930803-ZFxIWwhY";

    const el = (id) => document.getElementById(id);

    const startView = el("startView");
    const inputView = el("inputView");
    const confirmView = el("confirmView");
    const summaryEl = el("summary");

    // start actions
    const startBody = el("startBody");
    const startFacial = el("startFacial");

    // core
    const menu = el("menu");

    // body
    const bodyPurposeRow = el("bodyPurposeRow");
    const bodyPurpose = el("bodyPurpose");
    const bodyConcernRow = el("bodyConcernRow");

    const concernCheckboxes = [
      el("c_shoulder"), el("c_headache"), el("c_neck"), el("c_lowback"), el("c_swelling"),
      el("c_belly"), el("c_upperarm"), el("c_back"), el("c_hip"), el("c_thigh"), el("c_calf"),
    ];

    const dietDeadlineRow = el("dietDeadlineRow");
    const dietDeadline = el("dietDeadline");
    const dietFocusRow = el("dietFocusRow");
    const dietFocus = el("dietFocus");
    const dietGoalRow = el("dietGoalRow");
    const dietGoal = el("dietGoal");

    // facial
    const facialTypeRow = el("facialTypeRow");
    const facialType = el("facialType");

    // common
    const sleepBed = el("sleepBed");
    const sleepWake = el("sleepWake");

    const periodPain = el("periodPain");
    const periodPainLevelWrap = el("periodPainLevelWrap");
    const periodPainLevel = el("periodPainLevel");
    const periodCycle = el("periodCycle");

    const mealRhythm = el("mealRhythm");
    const breakfast = el("breakfast");
    const lunch = el("lunch");
    const dinner = el("dinner");
    const snack = el("snack");
    const favoriteFood = el("favoriteFood");
    const eatingOut = el("eatingOut");

    const alcoholFreq = el("alcoholFreq");
    const alcoholAmount = el("alcoholAmount");

    // â˜…smoking
    const smoking = el("smoking");
    const smokingAmountWrap = el("smokingAmountWrap");
    const smokingAmount = el("smokingAmount");

    const caffeineType = el("caffeineType");
    const caffeineCupsWrap = el("caffeineCupsWrap");
    const caffeineCups = el("caffeineCups");

    // actions
    const toStart = el("toStart");
    const toConfirm = el("toConfirm");
    const backBtn = el("backBtn");
    const sendBtn = el("sendBtn");

    document.addEventListener("DOMContentLoaded", async () => {
      try { await liff.init({ liffId: LIFF_ID }); }
      catch (e) { console.warn("LIFF init failed (ãƒ–ãƒ©ã‚¦ã‚¶ç¢ºèªä¸­ã¯OK):", e); }

      // æœ€åˆã¯äºŒæŠãƒšãƒ¼ã‚¸
      showView(startView);
      syncConditionalUI();
    });

    // ---- view helpers ----
    function showView(target){
      [startView, inputView, confirmView].forEach(v => {
        v.style.display = (v === target) ? "block" : "none";
        v.classList.remove("viewFade");
      });
      target.classList.add("viewFade");
      window.scrollTo({ top:0, behavior:"smooth" });
    }

    function goToSheet(selectedMenu){
      menu.value = selectedMenu;   // "ãƒœãƒ‡ã‚£" or "ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«"
      syncConditionalUI();
      showView(inputView);
    }

    startBody.addEventListener("click", () => goToSheet("ãƒœãƒ‡ã‚£"));
    startFacial.addEventListener("click", () => goToSheet("ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«"));

    toStart.addEventListener("click", () => {
      showView(startView);
    });

    // ---- conditional UI ----
    function clearBodyFields(){
      bodyPurpose.value = "";
      concernCheckboxes.forEach(chk => chk.checked = false);
      dietDeadline.value = "";
      dietFocus.value = "";
      dietGoal.value = "";
    }
    function clearFacialFields(){
      facialType.value = "";
    }

    function syncConditionalUI(){
      const m = menu.value;

      // menu switch
      const isBody = m === "ãƒœãƒ‡ã‚£";
      const isFacial = m === "ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«";

      bodyPurposeRow.style.display = isBody ? "block" : "none";
      bodyConcernRow.style.display = isBody ? "block" : "none";

      facialTypeRow.style.display = isFacial ? "block" : "none";

      if(!isBody) clearBodyFields();
      if(!isFacial) clearFacialFields();

      // diet extra
      const purpose = bodyPurpose.value;
      const showDiet = isBody && (purpose === "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ" || purpose === "ã©ã¡ã‚‰ã‚‚");
      dietDeadlineRow.style.display = showDiet ? "block" : "none";
      dietFocusRow.style.display = showDiet ? "block" : "none";
      dietGoalRow.style.display = showDiet ? "block" : "none";
      if(!showDiet){
        dietDeadline.value = "";
        dietFocus.value = "";
        dietGoal.value = "";
      }

      // period pain level
      const pp = periodPain.value;
      periodPainLevelWrap.style.display = (pp === "ã‚ã‚Š") ? "block" : "none";
      if(pp !== "ã‚ã‚Š") periodPainLevel.value = "";

      // caffeine cups
      caffeineCupsWrap.style.display = (caffeineType.value === "æ¯æ•°ã‚’å…¥åŠ›") ? "block" : "none";
      if(caffeineType.value !== "æ¯æ•°ã‚’å…¥åŠ›") caffeineCups.value = "";

      // â˜…smoking amount
      smokingAmountWrap.style.display = (smoking.value === "å¸ã†") ? "block" : "none";
      if(smoking.value !== "å¸ã†") smokingAmount.value = "";
    }

    // menuã¯éš ã‚Œã¦ã„ã‚‹ãŒã€ãƒ­ã‚¸ãƒƒã‚¯ç”¨ã«changeã‚‚æ®‹ã™
    menu.addEventListener("change", syncConditionalUI);
    bodyPurpose.addEventListener("change", syncConditionalUI);
    periodPain.addEventListener("change", syncConditionalUI);
    caffeineType.addEventListener("change", syncConditionalUI);
    smoking.addEventListener("change", syncConditionalUI);

    // ---- data ----
    function getFormData(){
      const m = menu.value;

      const concerns = concernCheckboxes
        .filter(chk => chk.checked)
        .map(chk => chk.value);

      const d = {
        menu: m,

        bodyPurpose: bodyPurpose.value,
        concerns,

        dietDeadline: dietDeadline.value.trim(),
        dietFocus: dietFocus.value,
        dietGoal: dietGoal.value.trim(),

        facialType: facialType.value,

        sleepBed: sleepBed.value,
        sleepWake: sleepWake.value,

        periodPain: periodPain.value,
        periodPainLevel: periodPainLevel.value,
        periodCycle: periodCycle.value,

        mealRhythm: mealRhythm.value,
        breakfast: breakfast.value,
        lunch: lunch.value,
        dinner: dinner.value,
        snack: snack.value,

        favoriteFood: favoriteFood.value.trim(),
        eatingOut: eatingOut.value,

        alcoholFreq: alcoholFreq.value,
        alcoholAmount: alcoholAmount.value.trim(),

        // â˜…smoking
        smoking: smoking.value,
        smokingAmount: smokingAmount.value,

        caffeineType: caffeineType.value,
        caffeineCups: caffeineCups.value
      };

      // display texts
      d.concernsText = concerns.length ? concerns.join("ã€") : "æœªé¸æŠ";
      d.periodPainText = d.periodPain === "ã‚ã‚Š"
        ? (d.periodPainLevel ? `ã‚ã‚Šï¼ˆ${d.periodPainLevel}ï¼‰` : "ã‚ã‚Šï¼ˆç¨‹åº¦æœªé¸æŠï¼‰")
        : (d.periodPain ? d.periodPain : "â€”");

      if(d.caffeineType === "ãªã—") d.caffeineText = "ãªã—";
      else if(d.caffeineType === "æ¯æ•°ã‚’å…¥åŠ›") d.caffeineText = (d.caffeineCups !== "" ? `${d.caffeineCups}æ¯` : "æ¯æ•°æœªå…¥åŠ›");
      else d.caffeineText = "â€”";

      d.sleepText = (d.sleepBed || d.sleepWake)
        ? `å°±å¯ï¼š${d.sleepBed || "â€”"} / èµ·åºŠï¼š${d.sleepWake || "â€”"}`
        : "â€”";

      d.mealsText = [
        `æœé£Ÿï¼š${d.breakfast || "â€”"}`,
        `æ˜¼é£Ÿï¼š${d.lunch || "â€”"}`,
        `å¤•é£Ÿï¼š${d.dinner || "â€”"}`
      ].join(" / ");

      d.alcoholText = (d.alcoholFreq || d.alcoholAmount)
        ? `${d.alcoholFreq || "â€”"} / é‡ï¼š${d.alcoholAmount || "â€”"}`
        : "â€”";

      // â˜…smoking text
      if(d.smoking === "å¸ã†"){
        d.smokingText = d.smokingAmount ? `å¸ã†ï¼ˆ${d.smokingAmount}ï¼‰` : "å¸ã†ï¼ˆæœ¬æ•°æœªé¸æŠï¼‰";
      }else if(d.smoking === "å¸ã‚ãªã„"){
        d.smokingText = "å¸ã‚ãªã„";
      }else{
        d.smokingText = "â€”";
      }

      return d;
    }

    function validate(){
      const d = getFormData();

      if(!d.menu){
        alert("ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        showView(startView);
        return null;
      }

      if(d.menu === "ãƒœãƒ‡ã‚£"){
        if(!d.bodyPurpose){
          alert("ç›®çš„ï¼ˆãƒœãƒ‡ã‚£ï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
          bodyPurpose.focus();
          return null;
        }
        if(!d.concerns.length){
          alert("æ°—ã«ãªã‚‹ã¨ã“ã‚ï¼ˆãƒœãƒ‡ã‚£ï¼‰ã‚’1ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„ã€‚");
          return null;
        }
        const showDiet = (d.bodyPurpose === "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ" || d.bodyPurpose === "ã©ã¡ã‚‰ã‚‚");
        if(showDiet){
          if(!d.dietDeadline){
            alert("ã€Œã„ã¤ã¾ã§ã«ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            dietDeadline.focus();
            return null;
          }
          if(!d.dietFocus){
            alert("ã€Œé‡è¦–ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
            dietFocus.focus();
            return null;
          }
          if(!d.dietGoal){
            alert("ã€Œç›®æ¨™ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            dietGoal.focus();
            return null;
          }
        }
      }

      if(d.menu === "ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«"){
        if(!d.facialType){
          alert("ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«å†…å®¹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
          facialType.focus();
          return null;
        }
      }

      // optional fields do not need validation except: period pain level when "ã‚ã‚Š"
      if(d.periodPain === "ã‚ã‚Š" && !d.periodPainLevel){
        alert("ç”Ÿç†ç—›ãŒã€Œã‚ã‚Šã€ã®å ´åˆã€ç¨‹åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        periodPainLevel.focus();
        return null;
      }

      // caffeine cups when "æ¯æ•°ã‚’å…¥åŠ›"
      if(d.caffeineType === "æ¯æ•°ã‚’å…¥åŠ›" && d.caffeineCups === ""){
        alert("ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã®æ¯æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        caffeineCups.focus();
        return null;
      }

      // â˜…smoking amount when "å¸ã†"
      if(d.smoking === "å¸ã†" && !d.smokingAmount){
        alert("ã‚¿ãƒã‚³ãŒã€Œå¸ã†ã€ã®å ´åˆã€æœ¬æ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        smokingAmount.focus();
        return null;
      }

      return d;
    }

    // ---- confirm step ----
    toConfirm.addEventListener("click", () => {
      const d = validate();
      if(!d) return;

      const rows = [];

      rows.push(["ãƒ¡ãƒ‹ãƒ¥ãƒ¼", d.menu]);

      if(d.menu === "ãƒœãƒ‡ã‚£"){
        rows.push(["ç›®çš„", d.bodyPurpose]);
        rows.push(["æ°—ã«ãªã‚‹ã¨ã“ã‚", d.concernsText]);

        const showDiet = (d.bodyPurpose === "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ" || d.bodyPurpose === "ã©ã¡ã‚‰ã‚‚");
        if(showDiet){
          rows.push(["ã„ã¤ã¾ã§ã«", d.dietDeadline]);
          rows.push(["é‡è¦–", d.dietFocus]);
          rows.push(["ç›®æ¨™", d.dietGoal]);
        }
      }

      if(d.menu === "ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«"){
        rows.push(["ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«å†…å®¹", d.facialType]);
      }

      rows.push(["ç¡çœ ", d.sleepText]);
      rows.push(["ç”Ÿç†ç—›", d.periodPainText]);
      rows.push(["ç”Ÿç†å‘¨æœŸ", d.periodCycle || "â€”"]);
      rows.push(["é£Ÿäº‹ãƒªã‚ºãƒ ", d.mealRhythm || "â€”"]);
      rows.push(["é£Ÿäº‹", d.mealsText]);
      rows.push(["é–“é£Ÿ", d.snack || "â€”"]);
      rows.push(["å¥½ããªé£Ÿã¹ç‰©", d.favoriteFood || "â€”"]);
      rows.push(["å¤–é£Ÿã®é »åº¦", d.eatingOut || "â€”"]);
      rows.push(["ãŠé…’", d.alcoholText]);
      rows.push(["ã‚¿ãƒã‚³", d.smokingText]);
      rows.push(["ã‚«ãƒ•ã‚§ã‚¤ãƒ³", d.caffeineText]);

      summaryEl.innerHTML = rows.map(([k,v]) => `
        <div class="sumRow">
          <div class="sumKey">${escapeHtml(k)}</div>
          <div class="sumVal">${escapeHtml(v)}</div>
        </div>
      `).join("");

      showView(confirmView);
    });

    backBtn.addEventListener("click", () => {
      showView(inputView);
    });

    // ---- send ----
    sendBtn.addEventListener("click", async () => {
      const d = validate();
      if(!d) return;

      const lines = [];
      lines.push("â‰ªã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã‚·ãƒ¼ãƒˆâ‰«");
      lines.push(`ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€‘${d.menu}`);

      if(d.menu === "ãƒœãƒ‡ã‚£"){
        lines.push(`ã€ç›®çš„ã€‘${d.bodyPurpose}`);
        lines.push(`ã€æ°—ã«ãªã‚‹ã¨ã“ã‚ã€‘${d.concernsText}`);
        const showDiet = (d.bodyPurpose === "ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ" || d.bodyPurpose === "ã©ã¡ã‚‰ã‚‚");
        if(showDiet){
          lines.push(`ã€ã„ã¤ã¾ã§ã«ã€‘${d.dietDeadline}`);
          lines.push(`ã€é‡è¦–ã€‘${d.dietFocus}`);
          lines.push(`ã€ç›®æ¨™ã€‘${d.dietGoal}`);
        }
      }

      if(d.menu === "ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«"){
        lines.push(`ã€ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«å†…å®¹ã€‘${d.facialType}`);
      }

      lines.push(`ã€ç¡çœ ã€‘${d.sleepText}`);
      lines.push(`ã€ç”Ÿç†ç—›ã€‘${d.periodPainText}`);
      lines.push(`ã€ç”Ÿç†å‘¨æœŸã€‘${d.periodCycle || "â€”"}`);
      lines.push(`ã€é£Ÿäº‹ãƒªã‚ºãƒ ã€‘${d.mealRhythm || "â€”"}`);
      lines.push(`ã€é£Ÿäº‹ã€‘${d.mealsText}`);
      lines.push(`ã€é–“é£Ÿã€‘${d.snack || "â€”"}`);
      lines.push(`ã€å¥½ããªé£Ÿã¹ç‰©ã€‘${d.favoriteFood || "â€”"}`);
      lines.push(`ã€å¤–é£Ÿã®é »åº¦ã€‘${d.eatingOut || "â€”"}`);
      lines.push(`ã€ãŠé…’ã€‘${d.alcoholText}`);
      lines.push(`ã€ã‚¿ãƒã‚³ã€‘${d.smokingText}`);
      lines.push(`ã€ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã€‘${d.caffeineText}`);

      const text = lines.join("\n");

      try{
        if(window.liff && liff.isInClient && liff.isInClient()){
          await liff.sendMessages([{ type:"text", text }]);
          alert("ã”è¨˜å…¥ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚");
          liff.closeWindow();
        }else{
          alert("ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ç¢ºèªï¼‰é€ä¿¡ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã¾ã—ãŸã€‚");
          console.log(text);
        }
      }catch(e){
        console.error(e);
        alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
      }
    });

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
  </script>
</body>
</html>
